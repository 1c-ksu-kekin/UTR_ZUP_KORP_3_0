
&НаКлиенте
Процедура ЮТР_ДатаНачалаПриИзменении(Элемент)
	
	УстановитьВыполнениеПослеОбработчиковСобытия("ЮТР_ДатаНачалаПриИзмененииПосле", Неопределено);
	
КонецПроцедуры

&НаКлиенте
Процедура ЮТР_ДатаОкончанияПриИзменении(Элемент)
	
	УстановитьВыполнениеПослеОбработчиковСобытия("ЮТР_ДатыОкончанияПриИзмененииПосле", Неопределено);
	
КонецПроцедуры

&НаКлиенте
Процедура ЮТР_ДатаНачалаПриИзмененииПосле(Элемент, ДополнительныйПараметр)
	
	ЮТР_УстановитьВидимостьПродолжаетБолеть(ЭтаФорма);
	ЮТР_ДатаНачалаПриИзмененииНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура ЮТР_ДатаНачалаПриИзмененииНаСервере()
	
	Если Не Объект.ЯвляетсяПродолжениемБолезни Тогда
		ЮТР_ЗаполнитьСтаж();
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ЮТР_ДатыОкончанияПриИзмененииПосле(Элемент, ДополнительныйПараметр)
	
	ЮТР_УстановитьВидимостьПродолжаетБолеть(ЭтаФорма);
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ЮТР_УстановитьВидимостьПродолжаетБолеть(Форма)
	
	//10.06.2015. было решено добавить видимость вне зависимости от даты окончания
	//Форма.Элементы.ЮТР_ПродолжаетБолеть.Видимость = НЕ ЗначениеЗаполнено(Форма.Объект.ДатаОкончания);
	//Форма.Объект.ЮТР_ПродолжаетБолеть = НЕ ЗначениеЗаполнено(Форма.Объект.ДатаОкончания);
	
КонецПроцедуры	

&НаКлиенте
Процедура ЮТР_ПослеЗаписи(ПараметрыЗаписи)
	
	УстановитьВыполнениеПослеОбработчиковСобытия("ЮТР_ПослеЗаписиНаКлиентеПосле", Неопределено);
	
КонецПроцедуры

&НаКлиенте
Процедура ЮТР_ПослеЗаписиНаКлиентеПосле(ПараметрыЗаписи, ДополнительныйПараметр)	
	
	// ЮТР начало изменения 
	//{32 574}, 07.05.2015
	//Создание оповещения о выходе основного работника из отпуска
	Если НЕ Объект.ЮТР_ПродолжаетБолеть И ЗначениеЗаполнено(Объект.ДатаОкончания) Тогда
		ЮТР_ОповещениеПользователейКлиент.ВыполнитьОповещениеСпециалистаКСПриВыходеОсновногоРаботника(Объект.Ссылка, Объект.Сотрудник, "da8363aa-f4a2-11e4-8291-e8039ae3f3e0");
	КонецЕсли;
	//ЮТР окончание изменения
	
КонецПроцедуры	

&НаСервере
Процедура ЮТР_ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	УстановитьВыполнениеПослеОбработчиковСобытия("ЮТР_ПриСозданииНаСервереПосле", Неопределено);
	
КонецПроцедуры

&НаСервере
Процедура ЮТР_ПриСозданииНаСервереПосле(Отказ, СтандартнаяОбработка, ДополнительныйПараметр)
	
	Если НЕ Параметры.Ключ.Пустая() Тогда  // форма нового
		
		//ЮТР начало изменения
		//{32 573}, 08.04.2015
		//будем скрывать флаг ЮТР_ПродолжаетБолеть в случае, если дата окончания нетрудоспособности заполнена.
		//10.06.2015. было решено добавить видимость вне зависимости от даты окончания
		//ЭтаФорма.Элементы.ЮТР_ПродолжаетБолеть.Видимость = НЕ ЗначениеЗаполнено(Объект.ДатаОкончания);
		//ЮТР окончание изменения
		
	КонецЕсли;
	
	Если Не ОграниченияНаУровнеЗаписей.ИзменениеБезОграничений И Объект.ДокументРассчитан Тогда 
		ЭтотОбъект.Элементы.ЮТР_НадписьСтаж.Гиперссылка = Ложь;
	КонецЕсли;
	
Конецпроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ЮТР_ОбновитьНадписьСтаж(Форма)
	
	Если НЕ ЗначениеЗаполнено(Форма.НадписьСтаж) Тогда
		
		НадписьСтаж  = "";
		
		Если Форма.ДляСотрудникаВведенСтраховойСтаж Тогда
			НадписьСтаж  = НСтр("ru = 'Страховой стаж: лет - %1; месяцев - %2.'");
			НадписьСтаж  = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НадписьСтаж, Форма.Объект.СтажЛет, Форма.Объект.СтажМесяцев);
		ИначеЕсли Форма.ДоступноИзменение Тогда
			НадписьСтаж  =  НСтр("ru = 'Ввести страховой стаж...'");
		Иначе
			НадписьСтаж  =  НСтр("ru = 'Страховой стаж не введен'");
		КонецЕсли;
		
		Форма.НадписьСтаж = НадписьСтаж;
		
	КонецЕсли; 
	
КонецПроцедуры

&НаСервере
Процедура ЮТР_ПриЧтенииНаСервере(ТекущийОбъект)
	
	УстановитьВыполнениеПослеОбработчиковСобытия("ЮТР_ПриЧтенииНаСервереПосле", Неопределено);	
	
КонецПроцедуры

&НаСервере
Процедура ЮТР_ПриЧтенииНаСервереПосле(ТекущийОбъект, ДополнительныйПараметр)
	
	ЮТР_ОбновитьНадписьСтаж(ЭтаФорма);	
	
КонецПроцедуры

&НаКлиенте
Процедура ЮТР_НадписьСтажНажатие(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	Если ЕстьФиксированныеДанные(ЭтаФорма) Тогда
		Оповещение = Новый ОписаниеОповещения("ЮТР_НадписьСтажНажатиеПродолжение", ЭтотОбъект);
		ПоказатьВопрос(Оповещение, НСтр("ru = 'Ручные исправления таблиц документа будут потеряны. Продолжить?'"), РежимДиалогаВопрос.ДаНет);
	Иначе
		ЮТР_НадписьСтажНажатиеПродолжение(КодВозвратаДиалога.Да, Неопределено);
	КонецЕсли;	
	
КонецПроцедуры

&НаКлиенте
Процедура ЮТР_НадписьСтажНажатиеПродолжение(Ответ, ДополнительныеПараметры) Экспорт
	
	Если Ответ <> КодВозвратаДиалога.Да Тогда 
		Возврат;
	КонецЕсли;
	
	Отказ = Ложь;
	Если НЕ ЗначениеЗаполнено(Объект.Сотрудник) Тогда
		Текст = Нстр("ru = 'Не выбран сотрудник'");
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(Текст, , "Объект.Сотрудник", ,Отказ);
	КонецЕсли;
	Если НЕ ЗначениеЗаполнено(Объект.ДатаНачалаСобытия) Тогда
		Текст = Нстр("ru = 'Не заполнена дата начала освобождения от работы'");
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(Текст, , "Объект.ДатаНачала", ,Отказ);
	КонецЕсли;
	Если Отказ Тогда 
		Возврат;
	КонецЕсли;
	
	КадровыйУчетРасширенныйКлиент.ОткрытьФормуРедактированияСтажейСотрудника(ЭтотОбъект, Объект.Сотрудник, Объект.ДатаНачалаСобытия, Новый ФиксированныйМассив(ВидыСтажаВЛисткеНетрудоспособности()));
	
КонецПроцедуры

&НаСервере
Процедура ЮТР_ЗаполнитьСтаж()
	
	ЮТР_ОбновитьНадписьСтаж(ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ЮТР_ОбновитьСтажиСотрудника()
	
	ЮТР_ЗаполнитьСтаж();
	
КонецПроцедуры

&НаКлиенте
Процедура ЮТР_ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	УстановитьВыполнениеПослеОбработчиковСобытия("ЮТР_ОбработкаОповещенияПосле", Неопределено);	
	
КонецПроцедуры

&НаКлиенте
Процедура ЮТР_ОбработкаОповещенияПосле(ИмяСобытия, Параметр, Источник, ДополнительныеПараметры)
	
	Если ИмяСобытия = "ИзмененСтажФизическогоЛица" И Источник.ВладелецФормы = ЭтаФорма Тогда
		ЮТР_ОбновитьНадписьСтаж(ЭтаФорма);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ЮТР_СотрудникПриИзменении(Элемент)
	
	УстановитьВыполнениеПослеОбработчиковСобытия("ЮТР_СотрудникПриИзмененииПосле", Неопределено);
	
КонецПроцедуры

&НаКлиенте
Процедура ЮТР_СотрудникПриИзмененииПосле(Элемент, ДополнительныеПараметры)
	
	ЮТР_ОработатьИзменениеСотрудникаНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура ЮТР_ОработатьИзменениеСотрудникаНаСервере()
	
	ЮТР_ЗаполнитьСтаж();
	
КонецПроцедуры




