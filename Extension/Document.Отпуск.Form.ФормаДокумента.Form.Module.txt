
&НаСервере
Процедура ЮТР_ПриЧтенииНаСервере(ТекущийОбъект)
	
	УстановитьВыполнениеПослеОбработчиковСобытия("ЮТР_ПриЧтенииНаСервереПосле", Неопределено);	
	
КонецПроцедуры

&НаСервере
Процедура ЮТР_ПриЧтенииНаСервереПосле(ТекущийОбъект, ДополнительныйПараметр)
	
	ЮТР_УстановитьВидимостьВспомогательныхРеквизитов(ТекущийОбъект);
	
КонецПроцедуры

&НаСервере
Процедура ЮТР_ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	УстановитьВыполнениеПослеОбработчиковСобытия("ЮТР_ПриСозданииНаСервереПосле", Неопределено);		
	
КонецПроцедуры

&НаСервере
Процедура ЮТР_ПриСозданииНаСервереПосле(Отказ, СтандартнаяОбработка, ДополнительныйПараметр)
	
	ЮТР_УстановитьВидимостьВспомогательныхРеквизитов(Объект);
	
КонецПроцедуры

&НаСервере
Процедура  ЮТР_УстановитьВидимостьВспомогательныхРеквизитов(ТекущийОбъект);
	
	ЭтоДокументИсправление = ЗначениеЗаполнено(ТекущийОбъект.ИсправленныйДокумент);
	ОбщегоНазначенияКлиентСервер.УстановитьСвойствоЭлементаФормы(Элементы, "ЮТР_ПредоставитьДниОчередногоОтпуска", "Видимость", ЭтоДокументИсправление);		
	
КонецПроцедуры


&НаКлиенте
Процедура ЮТР_ПередЗаписью(Отказ, ПараметрыЗаписи)
	      УстановитьВыполнениеПослеОбработчиковСобытия("ЮТР_ПередЗаписьюНаКлиентеПосле", Неопределено);
КонецПроцедуры

&НаКлиенте
Процедура ЮТР_ПередЗаписьюНаКлиентеПосле(Отказ, СтандартнаяОбработка, ДополнительныйПараметр)
		
	Если не СотрудникУволен(Объект.Сотрудник) Тогда
		Оповещение = Новый ОписаниеОповещения("СоздатьДокументУвольнение_ПослеВопроса", ЭтотОбъект);
		ПоказатьВопрос(Оповещение, НСтр("ru = 'Оформить приказ на увольнение?'"), РежимДиалогаВопрос.ДаНет);
	КонецЕсли

КонецПроцедуры 

&НаКлиенте
Процедура СоздатьДокументУвольнение_ПослеВопроса(Ответ, ДополнительныеПараметры) ЭКСПОРТ
	Если Ответ = КодВозвратаДиалога.Да Тогда
         ЮТР_СоздатьПриказНаУвольнениеНаКлиенте()
    КонецЕсли; 	
КонецПроцедуры


&НаСервере
Функция СотрудникУволен(Сотрудник) 
	 Результат = Ложь;
	 Запрос = Новый Запрос;
	 Запрос.Текст = "ВЫБРАТЬ
	                |	КадроваяИсторияСотрудниковСрезПоследних.ВидСобытия
	                |ИЗ
	                |	РегистрСведений.КадроваяИсторияСотрудников.СрезПоследних(&Дата, Сотрудник = &Сотрудник) КАК КадроваяИсторияСотрудниковСрезПоследних";
	Запрос.УстановитьПараметр("Сотрудник",Сотрудник);
	Запрос.УстановитьПараметр("Дата",ТекущаяДата());
	Выборка = Запрос.Выполнить().Выбрать();	
	 
	 Пока Выборка.Следующий() Цикл
		  
		  Результат = Выборка.ВидСобытия = Перечисления.ВидыКадровыхСобытий.Увольнение;
		  Прервать
			  
	 КонецЦикла;
	  
	 Возврат Результат;  	 
	 
КонецФункции	

	   



#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ЮТР_СоздатьПриказНаУвольнениеНаКлиенте()
	     		  
		  ФормаУвольнение = ПолучитьФорму("Документ.Увольнение.ФормаОбъекта", новый  Структура("ЗначенияЗаполнения",Новый Структура("Сотрудник, Организация", Объект.Сотрудник, Объект.Организация)));  
		  ФормаУвольнение.Открыть();   		  
		  
КонецПроцедуры

&НаКлиенте
Процедура ЮТР_СоздатьПриказНаУвольнение(Команда) 
	
		//ЮТР начало изменения 
		//{32 624}, 23.06.2015
		//Добавление возможности создать документ "Приказ на увольнение" из "Отпуска"                             
		ЮТР_СоздатьПриказНаУвольнениеНаКлиенте();	
		//ЮТР окончание изменения

 КонецПроцедуры


 
#КонецОбласти







